groups:
- name: croiscendence.rules
  rules:
    - alert: BackendDown
      expr: up{job="backend"} == 0
      for: 0s
      labels:
        severity: ðŸ”´ critical
      annotations:
        summary: "Game is down"
        description: "Game server is not responding"

    - alert: HighCPULoad
      expr: rate(node_cpu_seconds_total{mode!="idle"}[2m]) > 0.8
      for: 2m
      labels:
        severity: ðŸŸ¡ warning
      annotations:
        summary: "High CPU usage on {{ $labels.instance }}"

    # Alert for any instance that is unreachable for > 5 minutes.
    - alert: ServiceDown
      expr: up == 0
      for: 1m
      labels:
        severity: ðŸŸ¡ warning
      annotations:
        summary: "Service {{ $labels.instance }} down"
        description: "{{ $labels.instance }} of job {{ $labels.job }} has been down for more than a minute"

    # High Memory Usage
    - alert: HighMemoryUsage
      expr: nodejs_heap_size_used_bytes / nodejs_heap_size_total_bytes > 0.9
      for: 2m
      labels:
        severity: ðŸ”µ info
      annotations:
        summary: "Heap Memory almost full"
        description: "Heap Memory is using more than 80%"

    # High Lag Alert (Critical for Gaming)
    - alert: HighEventLoopLag
      expr: nodejs_eventloop_lag_seconds > 0.1
      for: 15s
      labels:
        severity: ðŸŸ¡ warning
      annotations:
        summary: "Server Lagging Detected"
        description: "Event loop lag is {{ $value }}s. Game is likely unplayable."
      